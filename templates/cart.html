{% extends "base.html" %}

{% block title %}Cart - Restaurant{% endblock %}

{% block body %}
<div class="container my-5" style="height: 80vh;">
    <h2 class="mb-4"><i class="bi bi-cart3"></i> Your Shopping Cart</h2>

    <div class="row">
        <!-- Cart Items -->
        <div class="col-md-8">
           <div id="cart-items">
                <!-- Empty Cart Message -->
                <div class="text-center py-5 border rounded" id="empty-cart">
                    <i class="bi bi-cart-x display-1 text-muted"></i>
                    <h4 class="mt-3 text-muted">Your cart is empty</h4>
                    <p class="text-muted">Add some delicious items from our menu!</p>
                    
                    <div class="mt-3">
                        <a href="/Food" class="btn btn-success me-2">
                            <i class="bi bi-egg-fried"></i> Browse Food
                        </a>
                        <a href="/Drinks" class="btn btn-primary">
                            <i class="bi bi-cup-straw"></i> Browse Drinks
                        </a>
                    </div>
                </div>
            </div>

            <!-- Continue Shopping Buttons -->
           <div class="mt-4 d-flex justify-content-between d-none" id="continue-shopping">
                <div>
                    <a href="/Food" class="btn btn-outline-secondary me-2">
                        <i class="bi bi-egg-fried"></i> Browse Food
                    </a>
                    <a href="/Drinks" class="btn btn-outline-secondary">
                        <i class="bi bi-cup-straw"></i> Browse Drinks
                    </a>
                </div>
                <button class="btn btn-outline-danger" onclick="clearCart()">
                    <i class="bi bi-trash"></i> Clear Cart
                </button>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-md-4">
            <div class="card shadow-sm d-none" id="cart-summary">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-receipt"></i> Order Summary</h5>

                    <div class="d-flex justify-content-between">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Delivery Fee:</span>
                        <span>$2.99</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Tax (8%):</span>
                        <span id="tax">$0.00</span>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between fw-bold">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>

                    <button class="btn btn-success w-100 mt-3" onclick="checkout()">
                        <i class="bi bi-credit-card"></i> Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Basic cart management
let cart = JSON.parse(localStorage.getItem('restaurantCart') || '{}');

const menuItems = {
    'pizza': { name: 'Margherita Pizza', price: 12.99, image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=80&h=80&fit=crop' },
    'burger': { name: 'Classic Burger', price: 9.99, image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=80&h=80&fit=crop' },
    'pasta': { name: 'Spaghetti Carbonara', price: 14.99, image: 'https://images.unsplash.com/photo-1551782450-a2132b4ba21d?w=80&h=80&fit=crop' },
    'juice': { name: 'Fresh Orange Juice', price: 4.99, image: 'https://images.unsplash.com/photo-1437418747212-8d9709afab22?w=80&h=80&fit=crop' }
};

function updateCartDisplay() {
    const cartItemsDiv = document.getElementById('cart-items');
    const emptyCart = document.getElementById('empty-cart');
    const cartSummary = document.getElementById('cart-summary');
    const continueShopping = document.getElementById('continue-shopping');

    if (Object.keys(cart).length === 0) {
        emptyCart.classList.remove("d-none");
        cartSummary.classList.add("d-none");
        continueShopping.classList.add("d-none");
        return;
    }

    emptyCart.classList.add("d-none");
    cartSummary.classList.remove("d-none");
    continueShopping.classList.remove("d-none");

    let html = '';
    let subtotal = 0;

    for (let id in cart) {
        const item = cart[id];
        const menuItem = menuItems[id];
        if (!menuItem) continue;

        const itemTotal = menuItem.price * item.quantity;
        subtotal += itemTotal;

        html += `
            <div class="card mb-3 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <img src="${menuItem.image}" class="rounded me-3" style="width: 80px; height: 80px; object-fit: cover;">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${menuItem.name}</h6>
                        <small class="text-muted">$${menuItem.price.toFixed(2)} each</small>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-secondary me-1" onclick="updateQuantity('${id}', -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-secondary ms-1" onclick="updateQuantity('${id}', 1)">+</button>
                        </div>
                    </div>
                    <div class="text-end ms-3">
                        <h6 class="text-success">$${itemTotal.toFixed(2)}</h6>
                        <button class="btn btn-sm btn-outline-danger mt-2" onclick="removeItem('${id}')"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            </div>
        `;
    }

    cartItemsDiv.innerHTML = html;

    // Totals
    const deliveryFee = 2.99;
    const tax = subtotal * 0.08;
    const total = subtotal + deliveryFee + tax;

    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
    document.getElementById('total').textContent = `$${total.toFixed(2)}`;
}

function updateQuantity(id, change) {
    if (cart[id]) {
        cart[id].quantity += change;
        if (cart[id].quantity <= 0) {
            delete cart[id];
        }
    }
    saveCart();
    updateCartDisplay();
}

function removeItem(id) {
    delete cart[id];
    saveCart();
    updateCartDisplay();
}

function clearCart() {
    cart = {};
    saveCart();
    updateCartDisplay();
}

function saveCart() {
    localStorage.setItem('restaurantCart', JSON.stringify(cart));
}

function checkout() {
    if (Object.keys(cart).length === 0) {
        alert('Your cart is empty!');
        return;
    }
    alert("Proceeding to checkout...");
}

document.addEventListener('DOMContentLoaded', updateCartDisplay);

// Temporary test data (remove later)
{% comment %} 
 cart = {
    'pizza': { quantity: 2 },
    'burger': { quantity: 1 }
};
saveCart();
updateCartDisplay();
{% endcomment %}

</script>
{% endblock %}

{% block footer %}

{% endblock %}